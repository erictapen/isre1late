module Tutorial exposing (view)

import Html exposing (button, div, text)
import Html.Attributes exposing (class, id, style)
import Html.Events exposing (onClick)
import List exposing (filterMap, map, map2)
import Model exposing (DistanceMatrix, TutorialState(..), stationPos, stations)
import Msg exposing (Msg(..))
import String exposing (fromFloat)
import Svg as S exposing (animate, circle, g, path, svg)
import Svg.Attributes as SA
    exposing
        ( attributeName
        , cx
        , cy
        , d
        , dur
        , fill
        , from
        , r
        , repeatCount
        , stroke
        , strokeWidth
        , to
        , values
        , viewBox
        )
import Utils exposing (maybe, removeNothings)


dotRadius =
    "1px"


geographicStations =
    [ ( "81.626198", "80.283630" )
    , ( "91.373772", "71.396141" )
    , ( "90.148270", "63.291927" )
    , ( "87.293282", "55.219959" )
    , ( "85.421181", "55.153568" )
    , ( "83.492653", "55.200993" )
    , ( "82.422882", "55.379269" )
    , ( "80.541756", "54.787533" )
    , ( "77.601013", "54.330463" )
    , ( "74.881439", "53.911297" )
    , ( "71.325691", "52.469868" )
    , ( "68.864532", "52.206249" )
    , ( "67.066902", "51.326221" )
    , ( "59.840305", "48.086826" )
    , ( "58.983810", "47.764385" )
    , ( "58.376701", "47.295918" )
    , ( "57.806835", "47.487492" )
    , ( "57.763954", "47.347134" )
    , ( "56.366932", "47.897152" )
    , ( "52.472645", "51.601231" )
    , ( "49.609764", "52.858685" )
    , ( "49.407768", "52.458500" )
    , ( "48.850315", "52.803684" )
    , ( "48.251106", "52.727818" )
    , ( "46.026928", "52.796093" )
    , ( "42.229687", "52.022282" )
    , ( "40.910526", "52.016590" )
    , ( "36.831169", "52.479366" )
    , ( "33.155800", "53.520603" )
    , ( "31.879524", "53.114727" )
    , ( "26.426847", "52.356075" )
    , ( "21.894983", "55.261677" )
    , ( "18.360672", "57.875202" )
    , ( "13.298435", "63.246418" )
    , ( "12.902349", "64.027817" )
    ]


brandenburgBerlinOutline =
    path
        [ id "brandenburg-berlin"
        , d "m 53.75005,17.53245 c -0.913456,0.02234 -0.854938,-0.901157 -1.235776,-1.46806 -0.10366,0.394021 -0.505017,-0.100867 -0.75295,0.1652 -0.107759,-0.48604 -0.404697,0.721456 -0.7153,0.293822 -0.581971,-0.16846 -0.419729,0.624911 -0.43212,1.075489 -0.308668,0.06864 -0.542256,-0.108926 -0.575507,0.21257 -0.181037,0.134332 -0.01291,0.668803 -0.32174,0.35083 -0.185472,0.01862 -0.699387,0.117022 -0.84381,0.39691 -0.230299,0.124438 -0.336904,0.361817 -0.48987,0.40229 0.205746,0.351308 -0.367167,0.578763 -0.42899,0.67908 -0.300741,-0.193266 -0.733936,0.531741 -0.924133,-0.14415 0.12302,-0.693917 -0.880737,0.32377 -0.460154,-0.331998 0.390104,-0.03349 0.446313,-0.44703 0.8294,-0.57119 -0.0948,-0.515772 -0.932764,-0.357866 -1.0752,-0.07974 0.345301,0.327196 0.01225,0.335385 -0.22133,0.28263 -0.472443,0.05366 0.0056,-0.05929 0.0069,-0.30357 -0.490206,-0.169908 -0.690393,0.141521 -1.044842,0.34513 -0.02539,0.619276 -0.632833,-0.0407 -0.85319,-0.218123 0.01861,-0.449454 -0.373234,-0.437585 -0.61733,-0.20105 -0.231945,-0.01619 -0.267208,0.0976 -0.38566,0.07968 -0.130522,0.256319 -0.103533,-0.446639 -0.25828,0.002 -0.227121,0.162139 -0.420611,0.206129 -0.65998,0.24874 -0.431884,0.0987 -0.638876,-0.46209 -1.00425,-0.51788 0.448569,-0.308149 0.696882,-1.436388 -0.131678,-0.94829 -0.554988,-0.08758 -1.184638,-0.101448 -1.698188,-0.34904 -0.2284,-0.222619 0.136766,-0.263021 -0.07798,-0.45353 0.207245,-0.113162 0.364869,-0.392601 0.05394,-0.334 -0.07821,-0.379868 -0.883608,-0.31189 -1.079836,-0.14038 -0.327468,0.02978 -0.448689,0.54733 -0.78664,0.14982 -0.770486,-0.351174 -1.946783,-1.126033 -2.496086,-0.276885 -0.429701,-0.149816 -1.026844,0.07301 -1.28867,0.1727 -0.441748,-0.442511 -0.353089,-1.338584 -1.235479,-1.28408 -0.310855,-0.305014 0.36222,-1.028151 -0.450231,-0.940732 -0.556124,-0.287772 -1.243634,-0.66812 -1.756967,-0.93518 -0.346718,-0.413502 -0.907559,0.09967 -1.322489,0.02859 -0.09147,-0.338776 -0.656172,-0.593339 -0.6637,-1.11575 -0.0507,-0.384376 -0.25861,-0.336255 -0.52208,-0.10832 -0.37025,-0.08754 -0.82284,-0.01604 -0.64524,0.40789 -0.691458,0.577596 -0.693321,-0.558082 -0.972473,-0.73972 -0.379293,-0.05005 -0.09904,0.132689 -0.34755,0.39628 -0.102268,0.276345 -0.82069,-0.101481 -0.74026,0.33373 -0.66415,0.06995 -0.718096,-0.496509 -0.6984,-0.99607 -0.140023,-0.176535 -0.758619,-0.196151 -0.78979,-0.10062 0.01906,0.282452 0.107639,0.532018 0.22224,0.857356 -0.3103,0.11892 -0.896658,0.477318 -1.024532,0.69846 0.247813,0.422213 -0.0058,0.841064 0.17006,1.26941 -0.194169,0.160509 -0.590729,0.153781 -0.71116,0.38714 -0.324462,-0.248391 -0.591422,-0.205469 -0.661669,0.20697 -0.165156,0.305943 -0.346951,0.432194 -0.37011,0.67813 -0.205414,0.173116 -0.265892,-0.142056 -0.66009,-0.0152 -0.323023,0.137098 -0.722061,-0.270444 -0.91169,-0.12723 0.01287,0.624227 -0.756897,0.683649 -0.78336,1.21541 -0.265108,-0.02386 -0.516971,-0.18384 -0.79918,-0.13488 -0.416265,-0.191124 -1.339915,-0.04114 -0.398457,0.272999 0.885124,0.549579 0.170668,0.844396 -0.392615,0.798497 -0.607406,-0.264089 -1.350078,0.474329 -1.83032,0.31676 0.178007,-0.802518 -0.639439,-0.303765 -0.717756,-1.052684 -0.451858,0.12253 -0.869433,-0.08443 -1.288659,0.20678 -0.446872,-0.134526 -0.755011,-0.08695 -0.879064,0.39259 -0.569671,0.161063 -0.685627,0.995808 -1.35854,0.75316 -0.478724,0.189254 0.09282,0.453701 -0.07109,0.88579 0.0345,0.396515 0.242327,0.657096 0.253842,1.15124 -0.372361,0.464555 -0.475072,0.634407 -0.358786,1.166389 -0.154142,0.294503 -1.222965,0.962186 -1.390239,0.472263 -0.7182694,-0.02822 -0.532438,-0.176061 -1.006578,-0.58983 -0.437463,0.269439 -1.007401,-0.183195 -1.1398114,0.12731 -0.4073641,-0.07686 -0.7168122,-0.08747 -0.557468,0.5064 0.4016569,0.568281 -0.04034,0.644762 -0.350953,0.635506 C 6.3239909,21.937352 6.0054289,21.791208 5.4194592,21.893932 5.265305,21.465774 4.7622805,22.00881 4.3428972,21.762902 c -0.3615249,-0.292788 -0.6835996,-0.156849 -0.560875,0.45516 0.1618266,0.967001 1.3725208,1.26367 1.7141276,2.177292 0.9267707,0.272664 1.6283859,-0.933755 2.5897976,-0.902827 1.1094105,-0.24267 1.5259224,2.087924 2.7285966,1.071571 0.471957,0.460195 1.220133,1.092926 1.936437,0.470338 0.835559,-0.106414 0.450568,0.65817 0.133199,0.99954 -0.0011,0.886501 0.904603,0.299343 1.32591,0.4514 0.176648,0.534084 0.268737,1.826724 1.07218,1.005171 0.896104,-0.669049 1.302523,0.612321 1.811163,1.04504 0.604567,-0.05214 2.047402,0.226311 1.240128,1.05453 -0.939598,0.587641 0.02241,1.449846 0.821488,1.117136 0.351876,1.001588 1.541872,0.481816 2.133897,1.117206 0.115617,0.07412 0.761952,0.512361 0.93782,0.05307 0.460829,0.09532 0.373718,-0.442895 0.848579,-0.33574 0.473781,0.149832 0.894388,-0.05713 1.130577,0.23514 0.379727,-0.298168 0.21904,0.639796 0.75496,0.273082 0.434112,0.442602 0.755752,-1.229165 0.59922,-0.493049 -0.148758,0.540778 0.262945,1.37521 0.175008,1.46988 0.650399,-0.2008 1.307643,-0.477777 1.71304,-0.988259 0.09048,0.343476 0.237075,0.576208 0.44911,0.688565 0.24588,-0.463807 0.640989,0.285294 0.476173,0.570887 0.271153,0.538463 0.148341,1.346548 0.61949,1.86818 -0.193356,0.110263 -0.156248,1.12666 -0.737933,0.63913 -0.41806,-0.08573 0.112077,0.784293 -0.41307,0.766267 0.245,0.480902 -0.42624,0.283052 -0.05533,0.832644 0.34623,0.06541 0.422062,0.748108 -0.01234,0.756847 -0.293331,0.385701 -0.05481,0.340272 -0.31265,0.72652 0.645025,-0.25829 -0.118372,0.422384 0.47511,0.388904 0.407689,0.216858 -0.290009,0.728943 0.28109,0.878174 0.329198,-0.118042 -0.234401,0.369249 0.20427,0.38313 0.202818,0.695445 -0.142747,0.886206 0.03045,1.646255 0.09971,0.529689 -0.589381,0.860736 -1.238741,0.853353 -0.846889,-0.411899 -0.199558,0.516156 -0.368287,0.959806 -0.06587,0.706845 0.426241,1.132044 -0.31255,1.542008 -0.148432,0.526797 -0.446082,1.024715 -0.45957,1.479699 0.189476,-0.06582 0.36121,-0.125421 0.49766,-0.30169 0.283666,-0.325678 0.955409,0.25085 0.39924,0.47797 -0.527063,0.305311 -0.0735,1.19493 0.243833,1.094338 0.336823,0.203748 0.516919,-0.278712 0.7346,-0.0948 0.408816,-0.04511 0.0839,-0.55434 0.404,-0.81558 -0.05535,-0.31232 0.884798,-0.01525 0.637535,0.37556 0.01177,0.378763 0.448563,0.433562 0.16826,0.68282 0.244867,0.465294 0.366734,0.200841 0.774062,0.10057 0.09771,-0.370967 0.515331,0.410634 0.75833,-0.151707 0.499553,0.201191 -0.5881,0.134125 -0.38911,0.622119 -0.06164,0.564334 0.772344,-0.165124 0.43562,0.33197 0.04198,0.455102 -0.366578,0.499141 -0.26076,0.92183 -0.563878,0.01141 -0.09967,0.480909 -0.39736,0.81184 -0.631127,0.0432 0.283577,0.475361 -0.366703,0.56343 -0.70015,0.26222 0.167862,0.582081 0.38369,0.5615 0.266248,0.471359 -0.650564,1.072736 0.14139,1.25763 -0.104429,0.387198 -0.939397,0.342712 -0.372334,0.82324 0.223769,0.402417 0.602571,0.615819 0.13874,1.075456 -0.460052,0.880818 -1.108719,1.819833 -1.176897,2.875581 0.239105,0.244116 -0.449847,0.782607 0.08349,0.79301 0.127718,0.174895 0.270634,0.242566 0.40733,0.31869 0.392499,0.24863 -0.573135,0.176786 -0.04715,0.21661 0.445074,-0.04982 0.408212,0.279343 0.72727,0.26954 -0.317116,0.54795 -0.516336,0.540129 -1.05504,0.62401 -0.565831,0.255879 0.245014,0.510209 -0.35087,0.80611 0.153555,0.371412 0.118613,0.789344 -0.34866,0.396377 -0.351227,0.575726 -0.365012,0.759803 0.113754,1.164643 -0.05805,0.90011 1.104191,1.056351 0.96694,1.976286 0.133882,0.708658 1.325353,0.551156 1.332903,1.39215 0.125617,0.622525 0.724238,0.976657 1.00992,1.458561 0.73357,-0.06388 0.97556,0.678744 1.51892,0.954117 0.304631,0.575253 0.85926,0.293416 0.89831,-0.265445 0.452547,-0.613044 0.628821,0.293769 0.81361,0.646719 0.350568,0.589986 1.564568,0.222781 1.25033,1.185449 0.462,0.25342 1.332243,0.240583 1.952309,0.21814 -0.319692,-0.773997 1.004789,-0.164872 0.834866,-0.98255 0.166072,-0.66298 0.690804,-0.197147 0.92188,0.09485 0.72695,-0.115665 0.939607,0.746598 1.631697,0.66387 0.346361,0.215937 0.879642,0.421918 0.70972,0.969202 0.564196,0.333287 1.327853,-0.107124 1.759242,-0.02466 0.392805,0.364775 -0.200547,1.493941 0.61392,1.329604 0.637168,-0.166785 0.487345,0.61959 1.16332,0.136526 -0.05037,-0.688542 0.824649,-0.05005 1.158902,-0.109936 -0.240213,0.490705 0.05597,0.485966 0.40738,0.61651 -0.08342,0.563193 -0.192781,0.858554 0.40403,0.665681 0.44785,-0.120235 0.81203,0.49938 0.82142,0.04376 0.39362,-0.07719 0.941557,0.445682 0.328461,0.516006 0.245935,0.642693 -0.566256,0.321712 0.02267,0.830764 0.501645,0.12689 1.098154,0.237098 1.305586,-0.08719 0.516805,0.09395 0.687313,-0.198787 0.891506,-0.409667 0.322187,0.09479 0.89488,0.58165 0.577771,1.01857 -0.675175,-0.06842 -0.691405,0.357168 -0.35533,0.87627 0.208412,0.687693 0.418925,0.784497 0.72088,1.494813 0.01466,0.304225 -0.196177,0.662001 0.228042,0.716997 -0.249581,0.183871 -0.27629,0.154656 -0.31132,0.585971 -0.509971,0.291494 0.0665,0.366626 -0.15007,0.644976 0.545496,0.102472 0.05068,0.482043 0.1084,0.52551 -0.182115,0.243247 0.401284,0.134208 0.29031,0.45727 0.378228,0.06605 0.699662,1.117149 0.17939,0.739756 -0.390249,-0.163106 0.12139,0.796463 -0.33404,0.22567 -0.378423,0.09469 0.04143,0.760065 -0.05091,0.840276 -0.405237,0.699505 -1.824205,1.225662 -2.614678,1.84927 -0.289597,0.354301 0.509642,1.045375 0.62173,1.424447 0.01685,0.747934 0.928085,0.299939 0.39383,0.02476 0.320605,0.429791 0.441933,-0.313968 0.665854,-0.0076 0.221945,0.404047 0.53886,0.864747 0.85287,0.81179 0.325918,0.377435 -0.874798,1.274127 -0.08366,1.433888 0.23581,0.418844 1.118513,0.05421 0.913968,0.921794 0.343438,0.697368 0.66139,1.331898 0.320335,1.942131 -0.155281,0.2287 -0.05765,0.506793 -0.45242,0.21254 0.02547,0.45481 -0.130231,1.199616 0.50644,1.528733 -0.09805,0.393286 -0.259576,0.837415 -0.55742,0.85918 -0.518368,0.478174 0.328667,0.697466 0.2168,0.05875 0.579989,0.04391 0.142594,1.158314 0.56074,1.547611 0.212977,0.371725 0.909937,0.07469 0.972806,0.27306 0.407364,0.265867 0.590473,0.340513 0.323833,-0.09291 -0.552531,-0.558375 0.813889,0.121805 0.571109,-0.476045 -0.04725,-0.433209 0.700189,-0.432503 0.809099,-0.762464 0.622033,-0.0014 -0.241151,-0.892586 0.391672,-0.53498 0.158147,0.534874 0.856418,-0.193973 1.15772,0.45893 0.298675,-0.178372 -0.436378,-0.735872 0.07796,-0.48008 0.06049,-0.340191 0.609891,-1.091722 0.608996,-0.451517 0.224462,0.460654 0.898319,0.645274 0.42203,1.06237 0.256696,0.05048 0.275501,-0.418777 0.58898,-0.17833 -0.101523,-0.574082 0.391925,0.736872 0.48624,-0.03415 0.418583,0.485609 0.108125,0.137927 0.0225,0.39829 -0.255336,0.440182 0.762444,0.379197 0.88482,0.60887 0.733669,-0.292952 0.511416,0.700588 0.673641,0.963461 0.454939,-0.174793 0.36163,0.968916 0.584579,0.187826 0.350345,-0.39049 1.138169,-0.532141 1.173496,0.102501 0.01411,0.485677 0.87308,0.02387 1.266109,0.227583 0.489643,0.141937 0.606567,-0.604462 0.956928,0.05687 0.23467,-0.586858 0.712484,0.4524 1.205181,0.161236 0.485542,0.430839 0.507371,-0.508179 0.92866,-0.29397 0.131194,0.02982 -0.281818,0.483414 -0.04061,0.42493 0.24925,0.04585 0.321804,-0.150355 0.49623,-0.39836 0.463755,-0.280857 0.910035,0.263567 1.201757,-0.26931 0.298693,-0.04208 -0.175982,-0.496087 0.37018,-0.24477 0.549824,-0.05058 0.658633,0.539335 1.139043,0.20493 0.23693,0.0641 0.508217,-0.01753 0.5912,-0.301622 0.580581,0.06839 1.069333,-0.942146 1.483882,-0.30535 -0.22014,0.626527 0.117526,0.848095 0.71884,0.817499 -0.342301,-0.497345 0.341581,-0.669508 0.10713,-0.99766 0.244533,-0.148699 0.9401,0.01692 0.34877,-0.25223 -0.232258,-0.405551 1.120427,-0.6143 0.506706,-1.143693 0.350614,-0.02523 -0.267761,-0.519818 0.457049,-0.63729 -0.09096,-0.173889 0.102751,-0.887228 -0.40413,-1.138009 -0.547785,-0.875295 0.862991,0.303535 1.176967,-0.328089 0.05996,-0.240136 -0.672194,-0.743435 0.0405,-0.735953 0.436213,-0.330874 0.189361,-1.507347 1.08108,-1.168412 0.515971,0.170718 -0.475001,-0.896624 0.337311,-0.92751 0.59555,0.343411 1.409905,0.02349 1.998461,0.2996 0.231041,0.270881 0.62509,0.107028 0.63073,0.37942 0.497776,-0.512991 1.226432,0.178315 1.85047,0.33408 0.200838,0.23729 0.277615,1.009976 0.56894,0.4022 -0.05674,-0.376781 -0.103208,-0.469662 0.388091,-0.51032 0.174008,-0.355947 0.722206,-0.387171 0.76174,-0.64298 0.09778,-0.455005 0.858158,0.271416 1.232282,-0.24849 0.503385,0.253872 0.14008,-0.916344 0.762817,-0.51596 0.461157,-0.242335 1.047086,-0.119108 1.377827,0.01508 0.327997,-0.215261 0.932943,-0.223975 0.64094,-0.78729 0.472044,0.34885 0.514329,-0.670277 0.9467,-0.24665 0.03114,0.322153 0.609,0.164494 0.5113,0.69807 0.02935,0.44868 0.318042,0.694339 0.80017,0.48188 0.565915,-0.402521 1.150123,0.433979 1.473993,-0.47788 0.113773,-0.364594 -0.02677,-0.718945 0.32578,-0.55401 0.02664,-0.237971 -0.390496,-1.383552 0.28548,-0.713106 0.155829,0.439476 0.46371,0.532624 0.65142,0.01907 0.58374,-0.251401 0.831085,-1.046662 0.31835,-1.55739 0.115543,-0.506335 -0.06046,-1.020718 0.06288,-1.46232 -0.09474,-0.323563 -0.301585,-0.608226 -0.46719,-0.81373 0.07782,-0.430604 -0.715535,-0.524909 -0.925208,-0.999537 -0.457108,-0.288233 -0.672249,-0.793088 -0.94549,-1.19689 -0.229154,-0.303772 -0.152243,-0.625168 -0.12276,-0.92763 0.386051,-0.206903 -0.576532,-0.238081 -0.11628,-0.59752 0.07263,-0.728312 -0.289261,-1.473858 -1.00749,-1.46425 -0.496553,-0.204035 -0.69714,-0.930881 -0.60044,-1.45089 -0.0033,-0.399646 0.519102,0.02972 0.34087,-0.49689 0.383969,0.402586 -0.218337,-0.659728 0.515645,-0.44573 0.585408,-0.350514 0.665729,-0.923852 1.025883,-1.386462 0.289102,0.09807 0.41831,-0.35678 0.73464,-0.54242 -0.07845,-0.426863 0.397498,-0.899379 0.34305,-1.392116 0.796829,-0.391584 -0.08102,-1.075695 -0.04164,-1.64067 0.107709,-0.313707 0.62838,-0.841921 0.2088,-1.282167 0.473133,-0.269922 0.599112,-0.923745 0.86102,-1.274559 0.01394,-0.474976 -0.204418,-0.909804 0.26076,-1.229096 -0.06668,-0.789697 -0.826424,-1.395867 -1.559449,-1.59137 -0.519244,-0.539999 -0.412327,-1.380594 -0.350891,-2.040752 0.641251,-0.510895 0.724689,-1.396309 0.06433,-1.908005 0.378427,-0.582775 1.172744,-1.590051 0.471513,-2.243691 -0.38422,-0.940421 -1.779604,-0.716511 -2.543532,-1.164529 -0.361892,-0.157806 -0.682543,-0.617511 -0.76623,-1.001451 0.469229,-0.335841 0.09777,-0.890534 -0.08581,-1.25371 -0.426043,-0.211689 -0.170404,-0.875819 -0.479568,-1.278333 0.376757,-0.936228 -0.989371,-1.677625 -0.14681,-2.497854 -0.272243,-0.660188 0.240281,-1.216865 0.85778,-1.280193 0.391974,-0.514502 0.791609,-1.009029 0.97393,-1.595037 0.834499,-0.464248 0.214371,-1.092363 -0.18719,-1.449035 -0.331598,-0.837453 0.01211,-1.812255 0.716539,-2.34421 -0.04639,-0.582412 -0.97286,-0.711726 -0.863363,-1.443343 -0.916722,-1.162529 -2.445949,-1.498507 -3.47331,-2.471385 -0.275714,-0.384384 -0.377065,-0.881971 -0.92416,-0.93314 -0.346471,-0.904965 -1.062881,-1.667069 -1.64988,-2.42958 -0.507181,-0.816784 -1.511717,-1.092433 -2.312179,-1.583773 -0.711026,-0.547096 -1.053047,-1.442468 -1.802106,-1.88147 -0.787065,-0.137026 -2.376085,0.05779 -2.07525,-1.18166 0.57283,-0.745579 1.235496,-1.567839 0.69184,-2.509195 -0.03738,-0.830977 -0.593627,-1.822434 -0.06761,-2.48644 0.508814,-0.08413 0.599547,-0.693203 1.182597,-0.80797 0.789229,-0.387917 1.583175,-0.769063 2.203896,-1.42252 0.584224,-0.657402 1.271207,-1.166068 1.78399,-1.84731 0.276705,-0.686531 0.477423,-1.387888 0.54393,-2.109113 0.265089,-0.751644 0.434655,-1.539713 -0.09373,-2.203843 -0.113495,-0.624703 -0.0051,-1.496587 0.39943,-1.944023 0.833816,-0.06518 0.484242,-1.24561 1.222206,-1.589362 0.03843,-0.507421 0.734828,-0.972593 0.2176,-1.395914 -0.893145,0.140846 -0.550005,-1.075659 -0.868807,-1.549588 0.751271,-0.927523 -0.634926,-1.064174 -0.751406,-0.299685 -0.250102,0.198608 -0.613737,-0.109788 -0.765019,0.32442 -0.441991,-0.02165 -0.960383,-0.247244 -0.92405,0.3887 -0.211626,0.633859 -0.547236,0.875602 -1.284042,1.06033 0.416477,0.763048 -0.261357,0.879397 -0.83622,0.88588 -0.446508,0.165888 -0.640434,-0.310633 -1.00304,-0.23144 -0.489848,-0.13533 -1.04533,-0.442114 -1.55719,-0.0056 -0.594066,0.214675 -0.947137,-0.18546 -0.516909,-0.847776 1.328288,-1.654015 3.782333,-3.095018 3.343607,-5.5191604 C 79.641671,8.7699937 79.278252,7.8667403 78.781504,8.5449817 77.912208,9.367486 77.124791,7.6849348 76.426363,7.9987646 76.285349,8.6333552 75.752305,8.7422935 75.495376,9.1158728 75.439908,9.1735396 74.816056,9.1150845 74.64453,9.0324218 74.795741,8.0926265 73.716868,8.5785387 73.300532,8.218774 72.585791,8.3821323 71.798885,8.321829 71.242281,8.723278 70.634304,8.4696363 71.301403,8.1142079 70.964601,7.769293 71.883761,7.5466392 70.6209,6.7582786 70.193852,6.5321204 70.446479,6.1614946 70.442169,6.0394647 70.149702,5.8189929 70.646678,5.052475 69.375453,4.729401 68.874681,4.5710231 68.701864,3.9886938 68.079588,3.4332737 68.301431,2.894412 c -0.724163,0.07976 -0.596998,1.4374589 -0.5101,1.9345343 0.504901,-0.023356 0.313392,0.952533 0.83078,0.508326 0.430075,0.093834 0.34769,0.1987024 0.02346,0.6505198 -0.405927,0.7350009 -1.504059,0.5471596 -1.859737,0.00758 -0.252106,0.3265264 -0.8134,-0.033243 -1.017802,0.5689764 -0.53795,0.3984261 -1.223517,0.7100924 -1.27304,1.261235 -0.461235,-0.3991675 -0.268659,0.526216 -0.531499,0.5632984 0.321828,0.2830741 -0.145732,1.2621248 -0.41859,0.703633 -0.335361,0.2599939 -0.813821,0.1180179 -1.14298,0.373632 -0.01894,0.2356983 -0.808194,0.2562302 -0.48188,0.529159 0.406346,0.077621 -0.188027,0.5751009 0.16064,0.6203699 -0.244291,0.232153 -0.32891,0.88015 -0.77625,0.470333 -0.264825,0.502526 -0.112152,0.626377 -0.03613,1.018477 -0.304977,0.229478 0.280713,1.233442 -0.35635,1.05081 -0.06976,-0.379139 -0.366811,-0.414229 -0.11494,-0.05501 -0.0085,0.312859 -0.286588,0.667454 -0.37935,1.00363 -0.114287,0.237881 -0.715049,0.46436 -0.85736,0.205 0.08729,-0.361934 -0.380767,-0.283283 -0.52111,-0.30372 -0.01453,0.222357 -0.006,0.362484 -0.01719,0.42517 0.374946,0.266253 -0.336799,0.163322 -0.24277,0.52182 -0.181278,0.464283 -0.52808,0.544401 -0.53495,0.95833 -0.07793,0.197345 0.05468,0.547428 -0.24286,0.29077 -0.09078,0.463104 -0.314799,-0.0658 -0.3608,-0.1099 -0.321559,-0.473388 -0.450418,-1.716351 -1.131859,-0.980645 -0.442718,-0.187028 -1.023649,-0.411624 -1.261993,-0.09858 -0.217637,0.123109 -0.344331,0.59613 -0.71661,0.56152 -0.178681,-0.0025 -0.226442,0.14505 -0.35163,0.3816 -0.08649,0.302775 0.0556,0.165844 0.08605,0.33978 -0.343562,0.243995 -0.125106,0.768362 -0.514531,1.237389 z M 29.673401,59.481641 c 0.08793,-0.0081 0.05486,0.155647 0,0 z M 60.72614,43.121495 c 0.03412,-0.03555 0.09674,-0.05451 0,0 z m 4.957289,9.735292 c -0.167507,0.295779 -0.492962,0.348446 0.01929,0.44979 0.07343,0.225009 -0.135475,0.825671 -0.48738,0.50104 -0.389574,0.193093 -0.397452,0.604588 -0.60434,0.90955 -0.09858,0.359603 -0.296124,0.647288 -0.50005,0.05904 -0.155822,-0.425596 0.434173,-0.841153 0.16593,-1.103873 0.0872,-0.350922 -0.391294,-0.06041 -0.42994,-0.335639 -0.343024,0.206595 -0.536386,0.400932 -0.57981,-0.08321 -0.313573,-0.16597 -0.119086,-0.711072 -0.61812,-0.35867 -0.476273,0.224868 -1.378463,0.147511 -1.049637,-0.40775 -0.327706,0.199374 -0.692582,-0.2461 -1.10598,0.0797 -0.671553,0.379397 -0.419552,-1.563777 -1.285,-0.743366 -0.496263,0.124558 -0.84706,0.339489 -0.51016,0.889721 0.294581,0.60637 -0.189392,0.969243 -0.73012,0.743462 -0.342466,-0.0416 -0.07994,-0.645979 -0.63184,-0.46095 0.08849,-0.405759 -0.744291,-0.585689 -0.71762,-0.98091 -0.420933,0.219994 -0.836942,0.802313 -1.03023,0.09494 -0.174946,-0.766601 -0.674866,0.599629 -1.233357,0.130863 -0.250307,0.01325 0.04306,-0.940102 -0.54533,-0.6147 -0.635197,0.05116 -1.421745,0.413352 -1.849366,0.85375 -0.193013,0.298034 0.656007,0.03134 0.12755,0.26552 -0.340572,-0.002 -0.815317,-0.294073 -0.80898,0.225785 -0.04106,0.258203 -0.138449,-0.28184 -0.06079,-0.06648 0.251438,-0.226489 0.266919,-0.441784 -0.137567,-0.27329 -0.252795,-0.277422 -0.561959,-0.493319 -0.354142,-0.62044 -0.09054,-0.249442 -0.146224,0.338342 -0.25829,-0.07024 -0.122987,-0.09389 0.02512,0.371552 -0.268441,0.0115 -0.129337,-0.672256 0.649575,-0.377837 0.688283,-1.003294 0.274512,-0.270785 -0.337986,-0.561711 -0.121714,-0.97712 -0.196958,-0.73916 0.587856,-0.923273 0.90274,-1.54032 0.269162,-0.339646 0.794078,-0.676217 0.11964,-0.86708 -0.557041,-0.206354 -1.14492,-0.06624 -0.75445,-0.906906 0.100013,-0.164552 0.05667,-0.986902 0.29385,-0.72651 0.533523,0.21767 0.209664,-0.607619 0.48625,-0.86325 0.11004,-0.553941 -0.331163,-0.246288 -0.56539,-0.31866 -0.262412,-0.342049 0.569218,-0.385277 0.76495,-0.74367 0.491065,0.05072 1.281831,0.85357 1.445435,0.21869 -0.616284,-0.349441 -0.346711,-0.737541 -0.035,-1.15325 -0.02141,-0.706941 0.971857,-0.08008 1.21753,-0.39072 0.0035,-0.388232 -0.169744,-0.567809 0.35442,-0.48177 0.43899,-0.207189 -0.262225,-1.094501 0.546099,-0.802275 0.565439,-0.02755 -0.226238,0.408804 0.2427,0.7075 -0.15963,0.180545 0.107464,0.651899 -0.11416,0.65276 0.464334,-0.08111 0.775182,0.304043 1.17474,0.15563 0.215514,0.08526 0.516473,-0.129793 0.65756,-0.25089 -0.0623,-0.327708 0.42686,-0.25423 0.33874,-0.52618 0.06979,-0.0183 0.01658,-0.33502 0.28088,-0.18253 0.306338,0.103552 0.599794,0.644741 0.82722,0.26556 0.02964,-0.411 0.383684,-0.471883 0.73033,-0.38712 0.296025,-0.199297 0.474538,-0.356052 -0.141076,-0.4841 -0.330301,-0.267269 0.413291,-0.456395 0.51896,-0.580373 0.113774,-0.125119 -0.271194,0.599945 0.20323,0.18406 0.04625,0.114346 0.03029,0.789319 0.52936,0.8858 0.454949,0.08596 0.500103,0.321531 0.30155,0.82894 -0.460116,0.203857 -0.623504,0.98572 -0.34739,1.36004 0.219103,0.417252 1.019484,0.145857 1.35513,0.63193 0.203467,0.222417 0.279,0.442994 0.50976,0.47636 0.217131,0.140466 0.218895,0.622478 0.23813,0.90377 0.250582,0.294673 1.160837,0.171378 1.25948,0.48602 -0.173152,0.133161 -0.405318,0.008 -0.26708,0.40023 0.364315,-0.09052 1.254015,0.05448 0.52937,0.41934 -0.549798,0.315849 -0.469666,1.114006 -0.59599,1.40581 -0.235864,0.250902 -0.272131,0.612523 -0.20418,0.76449 0.242371,-0.110077 0.1482,0.280264 0.24798,-0.02287 0.133017,-0.429892 0.718396,-0.401483 1.04155,-0.15921 0.233045,0.199317 0.651153,0.354668 0.81148,0.58267 0.233807,0.661318 0.09348,-0.336409 0.11034,-0.30726 0.481366,0.300065 0.668051,0.858226 1.31488,0.8538 0.04343,0.128052 0.276611,0.668645 0.04038,0.39461 -0.199008,-0.46187 -0.255895,0.526663 -0.64652,0.176468 -0.491883,-0.183313 0.39995,0.05041 0.23466,0.23154 -0.01093,0.09332 -0.443656,0.606989 -0.03297,0.85045 -0.0093,0.345572 -0.303603,0.500643 -0.59035,0.42714 -0.102432,0.121579 -0.380117,0.365206 -0.417621,0.316607 z"
        , stroke "grey"
        , strokeWidth "0.2px"
        , fill "none"
        ]
        []


pathRE1GeographicD =
    "M"
        ++ (String.join " L" <|
                map (\( x, y ) -> x ++ "," ++ y)
                    geographicStations
           )


stationPosTutorial distanceMatrix sid =
    fromFloat <|
        100
            - 100
            * stationPos distanceMatrix sid


pathRE1LinearD distanceMatrix =
    "M"
        ++ (String.join " L" <|
                map
                    (\( sid, _ ) ->
                        "95,"
                            ++ stationPosTutorial distanceMatrix sid
                    )
                    stations
           )


animateCX x =
    animate
        [ attributeName "cx"
        , dur "2s"
        , repeatCount "0"
        , from x
        , to "95"
        ]
        []


animateCY distanceMatrix y sid =
    animate
        [ attributeName "cy"
        , dur "2s"
        , repeatCount "0"
        , from y
        , to <| stationPosTutorial distanceMatrix sid
        ]
        []


view tutorialState distanceMatrix =
    case tutorialState of
        Geographic ->
            [ div [ id "row1" ]
                [ svg [ id "diagram", viewBox "0 0 100 100" ]
                    [ brandenburgBerlinOutline
                    , path
                        [ id "path-re1"
                        , stroke "black"
                        , strokeWidth "0.2px"
                        , fill "none"
                        , d <| pathRE1LinearD distanceMatrix
                        ]
                        [ animate
                            [ attributeName "d"
                            , dur "2s"
                            , repeatCount "0"
                            , from pathRE1GeographicD
                            , to <| pathRE1LinearD distanceMatrix
                            ]
                            []
                        ]
                    , g [] <|
                        removeNothings <|
                            (map
                                (\( ( x, y ), ( sid, station ) ) ->
                                    maybe station.important <|
                                        circle
                                            [ cx "95"
                                            , cy <| stationPosTutorial distanceMatrix sid
                                            , r dotRadius
                                            , stroke "none"
                                            , fill "black"
                                            ]
                                            [ animateCX x
                                            , animateCY distanceMatrix y sid
                                            ]
                                )
                             <|
                                map2 Tuple.pair geographicStations stations
                            )
                                ++ (map
                                        (\( ( x, y ), ( sid, station ) ) ->
                                            maybe (not station.important) <|
                                                circle
                                                    [ cx "95"
                                                    , cy <| stationPosTutorial distanceMatrix sid
                                                    , r "0.3px"
                                                    , stroke "none"
                                                    , fill "black"
                                                    ]
                                                    [ animateCX x
                                                    , animateCY distanceMatrix y sid
                                                    ]
                                        )
                                    <|
                                        map2 Tuple.pair geographicStations stations
                                   )
                    ]
                ]
            , div [ id "row2" ]
                [ button
                    [ id "skip-tutorial-button"
                    , onClick SkipTutorial
                    ]
                    [ text "Skip introduction" ]
                ]
            , div [ id "row3" ] []
            ]

        Location ->
            [ div [ id "row1" ]
                [ svg [ id "diagram", viewBox "0 0 100 100" ]
                    [ path
                        [ id "path-re1"
                        , stroke "black"
                        , strokeWidth "0.2px"
                        , fill "none"
                        , d <| pathRE1LinearD distanceMatrix
                        ]
                        []
                    ]
                , div [ class "station-legend" ] []
                ]
            , div [ id "row2" ]
                [ div [] []
                , div [ class "station-legend" ] []
                ]
            , div [ id "row3" ] []
            ]

        _ ->
            [ div [ id "row1" ]
                [ svg [ id "diagram", viewBox "0 0 100 100" ] []
                , div [ class "station-legend" ] []
                ]
            , div [ id "row2" ]
                [ div [] []
                , div [ class "station-legend" ] []
                ]
            , div [ id "row3" ] []
            ]
